# 千千静听歌词服务器

#### 介绍
千千静听歌词服务器
本地运行，数据来自qq音乐和网易云音乐

#### 软件架构
软件架构说明
Springboot


#### 安装教程

1.  下载源代码
2.  运行 mvn package 打包成jar文件
3.  运行jar文件
4.  修改千千静听的  **AddIn/ttp_lrcsh.dll**  文件，使其中一个服务器地址指向  **Localhost:8098** 
5.  启动千千静听，选择你修改过的哪个服务器即可搜索歌词

#### 使用说明

1.  默认每个接口查询50条结果（如果支持的话，目前两个接口都支持），如果需要修改，修改application.yml文件里面的pageNum即可，目前不支持单个接口修改
2.  网易云的接口在未登录的情况下只能返回20条结果，如果需要更多的返回结果，需要登录自己的网易云账号，提起cookie里面的MUSIC_U放到application.yml文件里面
3.  关于有效性，该程序实现了从本地直接调用音乐平台的接口来给千千静听续命，不依托第三方服务器，只相当代替你去搜索歌词，理论上只要你还能访问qq音乐、网易云这些网站就能一直续下去

#### 二次开发帮助
1.  设计上支持更多的搜索引擎，只需要实现MusicLrcSearch这个接口就会自动调用，目前不支持搜索引擎排序
2.  目前为了解决千千静听查询歌曲返回数据的歌词id不支持英文，使用了一个数据类 BuffData 来转义、存放临时的搜索结果，每记录到一首新歌曲就会占用一点内存空间，如果需要修改成在线服务，请自行设计解决方案。（重启程序会清空BuffData，作为单机运行影响不大）

#### 关于千千静听原本的请求和响应
1.千千静听在搜索的时候，会采用GET请求访问 ttp_lrcsh.dll 里面存放的地址，发送参数为
```JSON
{"ci":"...电脑特征码...","sh?Artist":"...歌手...","Title":"...歌曲名...","Flags":"...服务器序号(1/2)..."}
```
其中，歌手和歌曲名会经过UNICODE编码，需要自己解码。响应数据格式为
```XML
<?xml version="1.0" encoding="UTF-8"?>
<result>
	<lrc id='歌曲id' artist='歌手' title='歌曲名称'></lrc>
	<lrc id='1' artist='君と一緒にいればいい、佐天Tamako' title='さくら ~あなたに出会えてよかった~（樱花樱花想见你）（Cover RSP）'></lrc>
</result>
```
3.千千静听在下载歌词的时候，会采用GET请求访问 ttp_lrcsh.dll 里面存放的地址（与上一个地址相同，发送参数不同），发送参数为
```JSON
{"dl?Id":"...歌曲id...","ci":"...电脑特征码...","Code":"...歌曲特征码..."}
```
下载接口目前本项目只使用了id字段。响应数据直接返回lrc歌词文本即可

